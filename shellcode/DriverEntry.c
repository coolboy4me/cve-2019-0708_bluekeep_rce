#include <ntddk.h>

static void DriverpDriverUnload(
	PDRIVER_OBJECT driver_object)
{
	UNREFERENCED_PARAMETER(driver_object);
	DbgPrint("DriverpDriverUnload\n");
}

void __cdecl shellcode_start();
typedef void (__cdecl *shellcode_starttype)();


#ifndef _DEBUG
#define _DEBUG
#endif

void __cdecl calc_hash();
NTSTATUS
DriverEntry (
             IN PDRIVER_OBJECT   DriverObject,
             IN PUNICODE_STRING  RegistryPath)
{
    char * buf = NULL;
	char * str = NULL; 
    shellcode_starttype fun = NULL;
	UNREFERENCED_PARAMETER(DriverObject);
	UNREFERENCED_PARAMETER(RegistryPath);

#ifdef _DEBUG
	DriverObject->DriverUnload = DriverpDriverUnload;
#endif
	__asm int 3;
#if 0
    buf = (char*)ExAllocatePool(NonPagedPool, 4096);
    memset(buf, 0, 4096);
    memcpy(buf, shellcode_start, 1024);
    fun = (shellcode_starttype)buf;
    fun();
#else
	//str = "KeLeaveCriticalRegion";
	//calc_hash();
	shellcode_start();
#endif
	DbgPrint("DriverEntry\n");

    return STATUS_SUCCESS;
}


